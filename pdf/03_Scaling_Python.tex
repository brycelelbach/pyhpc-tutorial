
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass{article}

    
    
    \usepackage{graphicx} % Used to insert images
    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{color} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    

    
    
    \definecolor{orange}{cmyk}{0,0.4,0.8,0.2}
    \definecolor{darkorange}{rgb}{.71,0.21,0.01}
    \definecolor{darkgreen}{rgb}{.12,.54,.11}
    \definecolor{myteal}{rgb}{.26, .44, .56}
    \definecolor{gray}{gray}{0.45}
    \definecolor{lightgray}{gray}{.95}
    \definecolor{mediumgray}{gray}{.8}
    \definecolor{inputbackground}{rgb}{.95, .95, .85}
    \definecolor{outputbackground}{rgb}{.95, .95, .95}
    \definecolor{traceback}{rgb}{1, .95, .95}
    % ansi colors
    \definecolor{red}{rgb}{.6,0,0}
    \definecolor{green}{rgb}{0,.65,0}
    \definecolor{brown}{rgb}{0.6,0.6,0}
    \definecolor{blue}{rgb}{0,.145,.698}
    \definecolor{purple}{rgb}{.698,.145,.698}
    \definecolor{cyan}{rgb}{0,.698,.698}
    \definecolor{lightgray}{gray}{0.5}
    
    % bright ansi colors
    \definecolor{darkgray}{gray}{0.25}
    \definecolor{lightred}{rgb}{1.0,0.39,0.28}
    \definecolor{lightgreen}{rgb}{0.48,0.99,0.0}
    \definecolor{lightblue}{rgb}{0.53,0.81,0.92}
    \definecolor{lightpurple}{rgb}{0.87,0.63,0.87}
    \definecolor{lightcyan}{rgb}{0.5,1.0,0.83}
    
    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{03\_Scaling\_Python}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=blue,
      linkcolor=darkorange,
      citecolor=darkgreen,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \section{Scaling Python}\label{scaling-python}

\section{Python in HPC Tutorial}\label{python-in-hpc-tutorial}

\subsection{Supercomputing 2014}\label{supercomputing-2014}

Presenter: Matthew G. Knepley

Contributors: - Aron Ahmadia - Andy R. Terrel - Matthew G. Knepley

Matt Knepley and Aron Ahmadia

\href{http://creativecommons.org/licenses/by/3.0/deed.en_US}{\includegraphics{./files/figures/creative_commons_logo.png}}

    \subsection{Acknowledgements}\label{acknowledgements}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  \href{http://code.google.com/p/mpi4py/}{mpi4py} is a
  \href{http://www.cython.org/}{Cythonized} wrapper around
  \href{http://www.mpi-forum.org/}{MPI} originally developed by
  \href{http://plus.google.com/107621373684536061961/about}{Lisandro
  Dalcin}, CONICET
\end{itemize}

    \subsection{Slideshow Setup Code}\label{slideshow-setup-code}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{o}{\PYZpc{}}\PY{k}{matplotlib} \PY{n}{inline}
\end{Verbatim}

    \subsection{Connecting to MPI via
IPython}\label{connecting-to-mpi-via-ipython}

To run the examples in parallel, you must run the command:

\texttt{ipcluster start -\/-engines=MPI -\/-n 4}

Or use notebook Appendix\_03\_Launch\_MPI\_Engines (if you are using the
VMs or have this configured for your environment).

Then execute the next cell:

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{k+kn}{from} \PY{n+nn}{IPython.parallel} \PY{k+kn}{import} \PY{n}{Client}
        \PY{n}{c} \PY{o}{=} \PY{n}{Client}\PY{p}{(}\PY{p}{)}
        \PY{n}{view} \PY{o}{=} \PY{n}{c}\PY{p}{[}\PY{p}{:}\PY{p}{]}
        
        \PY{o}{\PYZpc{}}\PY{k}{load\PYZus{}ext} \PY{n}{parallelmagic}
        \PY{n}{view}\PY{o}{.}\PY{n}{activate}\PY{p}{(}\PY{p}{)}
        \PY{n}{view}\PY{o}{.}\PY{n}{block} \PY{o}{=} \PY{n+nb+bp}{True}
\end{Verbatim}

    \begin{center}\rule{3in}{0.4pt}\end{center}

\subsection{The Message Passing Model}\label{the-message-passing-model}

\begin{itemize}
\item
  a process is (traditionally) a program counter for instructions and an
  address space for data
\item
  processes may have multiple threads (program counters and associated
  stacks) sharing a single address space
\item
  message passing is for communication among processes, which have
  separate address spaces
\item
  interprocess communication consists of
\item
  synchronization
\item
  movement of data from one process's address space to another's
\end{itemize}

    \begin{center}\rule{3in}{0.4pt}\end{center}

\subsection{Why MPI?}\label{why-mpi}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  \textbf{communicators} encapsulate communication spaces for library
  safety
\item
  \textbf{datatypes} reduce copying costs and permit heterogeneity
\item
  multiple \textbf{communication modes} allow more control of memory
  buffer management
\item
  extensive \textbf{collective operations} for scalable global
  communication
\item
  \textbf{process topologies} permit efficient process placement, user
  views of process layout
\item
  \textbf{profiling interface} encourages portable tools
\end{itemize}

It Scales!

    \begin{center}\rule{3in}{0.4pt}\end{center}

\subsection{MPI - Quick Review}\label{mpi---quick-review}

\begin{itemize}
\item
  processes can be collected into \textbf{groups}
\item
  each message is sent in a \textbf{context}, and must be received in
  the same context
\item
  a \textbf{communicator} encapsulates a context for a specific group
\item
  a given program may have many communicators with any level of overlap
\item
  two initial communicators
\item
  \texttt{MPI\_COMM\_WORLD} (all processes)
\item
  \texttt{MPI\_COMM\_SELF} (current process)
\end{itemize}

    \begin{longtable}[c]{@{}l@{}}
\toprule\addlinespace
First Example: Hello World
\\\addlinespace
\bottomrule
\end{longtable}

Ths user will have to install mpi4py

\begin{verbatim}
  pip install mpi4py
\end{verbatim}

It is crucial here that the proper \texttt{mpiexec} for your MPI
installation be in the path.

For interactive convenience, we load the parallel magic extensions and
make this view the active one for the automatic parallelism magics.

This is not necessary and in production codes likely won't be used, as
the engines will load their own MPI codes separately. But it makes it
easy to illustrate everything from within a single notebook here.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}}]:} \PY{k+kn}{from} \PY{n+nn}{IPython.parallel} \PY{k+kn}{import} \PY{n}{Client}
       \PY{n}{c} \PY{o}{=} \PY{n}{Client}\PY{p}{(}\PY{p}{)}
       \PY{n}{view} \PY{o}{=} \PY{n}{c}\PY{p}{[}\PY{p}{:}\PY{p}{]}
       
       \PY{o}{\PYZpc{}}\PY{k}{load\PYZus{}ext} \PY{n}{parallelmagic}
       \PY{n}{view}\PY{o}{.}\PY{n}{activate}\PY{p}{(}\PY{p}{)}
       \PY{n}{view}\PY{o}{.}\PY{n}{block} \PY{o}{=} \PY{n+nb+bp}{True}
\end{Verbatim}

    Use the autopx magic to make the rest of these cell execute on the
engines instead of locally

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{o}{\PYZpc{}}\PY{k}{autopx}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
\%autopx enabled
    \end{Verbatim}

    With autopx enabled, the next cell will actually execute \emph{entirely
on each engine}:

    \subsection{Hello World}\label{hello-world}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{k+kn}{from} \PY{n+nn}{mpi4py} \PY{k+kn}{import} \PY{n}{MPI}
        
        \PY{n}{size} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{COMM\PYZus{}WORLD}\PY{o}{.}\PY{n}{Get\PYZus{}size}\PY{p}{(}\PY{p}{)}
        \PY{n}{rank} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{COMM\PYZus{}WORLD}\PY{o}{.}\PY{n}{Get\PYZus{}rank}\PY{p}{(}\PY{p}{)}
        \PY{n}{name} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{Get\PYZus{}processor\PYZus{}name}\PY{p}{(}\PY{p}{)}
        
        \PY{k}{print}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Hello World! I am process }\PY{l+s+si}{\PYZpc{}d}\PY{l+s}{ of }\PY{l+s+si}{\PYZpc{}d}\PY{l+s}{ on }\PY{l+s+si}{\PYZpc{}s}\PY{l+s}{.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{rank}\PY{p}{,} \PY{n}{size}\PY{p}{,} \PY{n}{name}\PY{p}{)}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[stdout:0] 
Hello World! I am process 0 of 4 on MATTHEW-KNEPLEYs-MacBook-Air-2.local.

[stdout:1] 
Hello World! I am process 3 of 4 on MATTHEW-KNEPLEYs-MacBook-Air-2.local.

[stdout:2] 
Hello World! I am process 1 of 4 on MATTHEW-KNEPLEYs-MacBook-Air-2.local.

[stdout:3] 
Hello World! I am process 2 of 4 on MATTHEW-KNEPLEYs-MacBook-Air-2.local.
    \end{Verbatim}

    \begin{center}\rule{3in}{0.4pt}\end{center}

\subsection{Functionality}\label{functionality}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  There are hundreds of functions in the MPI standard, not all of them
  are necessarily available in MPI4Py, most commonly used are
\item
  No need to call MPI\_Init() or MPI\_Finalize()
\item
  MPI\_Init() is called when you import the module
\item
  MPI\_Finalize() is called before the Python process ends
\item
  To launch: mpiexec -n \textless{} number of process \textgreater{}
  -machinefile \textless{} hostlist \textgreater{} python \textless{} my
  MPI4Py python script \textgreater{}
\item
  IPython automatically handles calling mpiexec for you with the
  \texttt{ipcluster} command
\end{itemize}

    \subsection{MPI Basic (Blocking) Send}\label{mpi-basic-blocking-send}

\begin{verbatim}
   int MPI_Send(void* buf, int count, MPI_Datatype type, 
   int dest, int tag, MPI_Comm comm)
\end{verbatim}

\subsubsection{mpi4py}\label{mpi4py}

\begin{verbatim}
  Comm.Send(self, buf, int dest=0, int tag=0)
  Comm.send(self, obj=None, int dest=0, int tag=0)
\end{verbatim}

    \subsection{MPI Basic (Blocking) Recv}\label{mpi-basic-blocking-recv}

\begin{verbatim}
   int MPI_Recv(void* buf, int count, MPI_Datatype type, 
   int source, int tag, MPI_Comm comm, MPI_Status status)
\end{verbatim}

\subsubsection{mpi4py}\label{mpi4py}

\begin{verbatim}
  comm.Recv(self, buf, source=0, tag=0, status=None)
  comm.recv(self, obj=None, source=0, tag=0, status=None)
\end{verbatim}

    \subsection{Send/Receive Example (lowercase convenience
methods)}\label{sendreceive-example-lowercase-convenience-methods}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{k+kn}{from} \PY{n+nn}{mpi4py} \PY{k+kn}{import} \PY{n}{MPI}
        
        \PY{n}{comm} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{COMM\PYZus{}WORLD}
        \PY{n}{rank} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}rank}\PY{p}{(}\PY{p}{)}
        
        \PY{k}{if} \PY{n}{rank} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
           \PY{n}{data} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s}{\PYZsq{}}\PY{l+s}{a}\PY{l+s}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{b}\PY{l+s}{\PYZsq{}}\PY{p}{:} \PY{l+m+mf}{3.14}\PY{p}{\PYZcb{}}
           \PY{n}{comm}\PY{o}{.}\PY{n}{send}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{dest}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{tag}\PY{o}{=}\PY{l+m+mi}{11}\PY{p}{)}
        \PY{k}{elif} \PY{n}{rank} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}
           \PY{n}{data} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{recv}\PY{p}{(}\PY{n}{source}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{tag}\PY{o}{=}\PY{l+m+mi}{11}\PY{p}{)}
           \PY{k}{print} \PY{n}{data}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[stdout:2] \{'a': 7, 'b': 3.14\}
    \end{Verbatim}

    \begin{longtable}[c]{@{}l@{}}
\toprule\addlinespace
Send/Receive Example (MPI API on numpy)
\\\addlinespace
\bottomrule
\end{longtable}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{k+kn}{from} \PY{n+nn}{mpi4py} \PY{k+kn}{import} \PY{n}{MPI}
        \PY{k+kn}{import} \PY{n+nn}{numpy}
        
        \PY{n}{comm} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{COMM\PYZus{}WORLD}
        \PY{n}{rank} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}rank}\PY{p}{(}\PY{p}{)}
        
        \PY{c}{\PYZsh{} pass explicit MPI datatypes}
        \PY{k}{if} \PY{n}{rank} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
           \PY{n}{data} \PY{o}{=} \PY{n}{numpy}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{l+m+mi}{1000}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{i}\PY{l+s}{\PYZsq{}}\PY{p}{)}
           \PY{n}{comm}\PY{o}{.}\PY{n}{Send}\PY{p}{(}\PY{p}{[}\PY{n}{data}\PY{p}{,} \PY{n}{MPI}\PY{o}{.}\PY{n}{INT}\PY{p}{]}\PY{p}{,} \PY{n}{dest}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{tag}\PY{o}{=}\PY{l+m+mi}{77}\PY{p}{)}
        \PY{k}{elif} \PY{n}{rank} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}
           \PY{n}{data} \PY{o}{=} \PY{n}{numpy}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{l+m+mi}{1000}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{i}\PY{l+s}{\PYZsq{}}\PY{p}{)}
           \PY{n}{comm}\PY{o}{.}\PY{n}{Recv}\PY{p}{(}\PY{p}{[}\PY{n}{data}\PY{p}{,} \PY{n}{MPI}\PY{o}{.}\PY{n}{INT}\PY{p}{]}\PY{p}{,} \PY{n}{source}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{tag}\PY{o}{=}\PY{l+m+mi}{77}\PY{p}{)}
        
        \PY{c}{\PYZsh{} or take advantage of automatic MPI datatype discovery}
        \PY{k}{if} \PY{n}{rank} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
           \PY{n}{data} \PY{o}{=} \PY{n}{numpy}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{numpy}\PY{o}{.}\PY{n}{float64}\PY{p}{)}
           \PY{n}{comm}\PY{o}{.}\PY{n}{Send}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{dest}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{tag}\PY{o}{=}\PY{l+m+mi}{13}\PY{p}{)}
        \PY{k}{elif} \PY{n}{rank} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}
           \PY{n}{data} \PY{o}{=} \PY{n}{numpy}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{numpy}\PY{o}{.}\PY{n}{float64}\PY{p}{)}
           \PY{n}{comm}\PY{o}{.}\PY{n}{Recv}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{source}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{tag}\PY{o}{=}\PY{l+m+mi}{13}\PY{p}{)}
           \PY{k}{print} \PY{n}{data}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[stdout:2] [ 0.  1.  2.  3.  4.  5.  6.  7.  8.  9.]
    \end{Verbatim}

    \subsection{Synchronization}\label{synchronization}

\begin{verbatim}
   int MPI_Barrier(MPI_Comm comm)
\end{verbatim}

\subsubsection{mpi4py}\label{mpi4py}

\begin{verbatim}
   comm.Barrier(self)
   comm.barrier(self)
\end{verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{k+kn}{from} \PY{n+nn}{mpi4py} \PY{k+kn}{import} \PY{n}{MPI}
        
        \PY{n}{comm} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{COMM\PYZus{}WORLD}
        \PY{n}{rank} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}rank}\PY{p}{(}\PY{p}{)}
        
        \PY{k}{for} \PY{n}{r\PYZus{}id} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}size}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{:}
            \PY{k}{if} \PY{n}{rank} \PY{o}{==} \PY{n}{r\PYZus{}id}\PY{p}{:}
                \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{Hello from proc:}\PY{l+s}{\PYZdq{}}\PY{p}{,} \PY{n}{rank}
            \PY{n}{comm}\PY{o}{.}\PY{n}{Barrier}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[stdout:0] Hello from proc: 0
[stdout:1] Hello from proc: 3
[stdout:2] Hello from proc: 1
[stdout:3] Hello from proc: 2
    \end{Verbatim}

    Notice that MPI rank does not coincide with IPython rank

    \subsection{Timing and Profiling}\label{timing-and-profiling}

the elapsed (wall-clock) time between two points in an MPI program can
be computed using MPI\_Wtime:

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{n}{t1} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{Wtime}\PY{p}{(}\PY{p}{)}
        \PY{n}{t2} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{Wtime}\PY{p}{(}\PY{p}{)}
        \PY{k}{print}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{time elapsed is: }\PY{l+s+si}{\PYZpc{}e}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{t2}\PY{o}{\PYZhy{}}\PY{n}{t1}\PY{p}{)}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[stdout:0] 
time elapsed is: 7.049413e-05

[stdout:1] 
time elapsed is: 7.011974e-05

[stdout:2] 
time elapsed is: 7.037306e-05

[stdout:3] 
time elapsed is: 6.986130e-05
    \end{Verbatim}

    \subsection{Broadcast Example}\label{broadcast-example}

\begin{verbatim}
   int MPI_Bcast(void *buf, int count, MPI_Datatype type, 
   int root, MPI_Comm comm)
\end{verbatim}

\subsubsection{mpi4py}\label{mpi4py}

\begin{verbatim}
  comm.Bcast(self, buf, root=0)
  comm.bcast(self, obj=None, root=0)
\end{verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{k+kn}{from} \PY{n+nn}{mpi4py} \PY{k+kn}{import} \PY{n}{MPI}
        
        \PY{n}{comm} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{COMM\PYZus{}WORLD}
        \PY{n}{rank} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}rank}\PY{p}{(}\PY{p}{)}
        
        \PY{k}{if} \PY{n}{rank} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
           \PY{n}{data} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s}{\PYZsq{}}\PY{l+s}{key1}\PY{l+s}{\PYZsq{}} \PY{p}{:} \PY{p}{[}\PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mf}{2.72}\PY{p}{,} \PY{l+m+mi}{2}\PY{o}{+}\PY{l+m+mi}{3j}\PY{p}{]}\PY{p}{,}
                   \PY{l+s}{\PYZsq{}}\PY{l+s}{key2}\PY{l+s}{\PYZsq{}} \PY{p}{:} \PY{p}{(} \PY{l+s}{\PYZsq{}}\PY{l+s}{abc}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{xyz}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{\PYZcb{}}
        \PY{k}{else}\PY{p}{:}
           \PY{n}{data} \PY{o}{=} \PY{n+nb+bp}{None}
        \PY{n}{data} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{bcast}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{root}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
        \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{bcast finished and data }\PY{l+s+se}{\PYZbs{}}
        \PY{l+s}{ on rank }\PY{l+s+si}{\PYZpc{}d}\PY{l+s}{ is: }\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{comm}\PY{o}{.}\PY{n}{rank}\PY{p}{,} \PY{n}{data}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[stdout:0] 
bcast finished and data  on rank 0 is: 
\{'key2': ('abc', 'xyz'), 'key1': [7, 2.72, (2+3j)]\}
[stdout:1] 
bcast finished and data  on rank 3 is: 
\{'key2': ('abc', 'xyz'), 'key1': [7, 2.72, (2+3j)]\}
[stdout:2] 
bcast finished and data  on rank 1 is: 
\{'key2': ('abc', 'xyz'), 'key1': [7, 2.72, (2+3j)]\}
[stdout:3] 
bcast finished and data  on rank 2 is: 
\{'key2': ('abc', 'xyz'), 'key1': [7, 2.72, (2+3j)]\}
    \end{Verbatim}

    \subsection{Scatter Example}\label{scatter-example}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}10}]:} \PY{k+kn}{from} \PY{n+nn}{mpi4py} \PY{k+kn}{import} \PY{n}{MPI}
         
         \PY{n}{comm} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{COMM\PYZus{}WORLD}
         \PY{n}{size} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}size}\PY{p}{(}\PY{p}{)}
         \PY{n}{rank} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}rank}\PY{p}{(}\PY{p}{)}
         
         \PY{k}{if} \PY{n}{rank} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
            \PY{n}{data} \PY{o}{=} \PY{p}{[}\PY{p}{(}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{size}\PY{p}{)}\PY{p}{]}
         \PY{k}{else}\PY{p}{:}
            \PY{n}{data} \PY{o}{=} \PY{n+nb+bp}{None}
         \PY{n}{data} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{scatter}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{root}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{k}{assert} \PY{n}{data} \PY{o}{==} \PY{p}{(}\PY{n}{rank}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
         \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{data on rank }\PY{l+s+si}{\PYZpc{}d}\PY{l+s}{ is: }\PY{l+s}{\PYZdq{}}\PY{o}{\PYZpc{}}\PY{k}{comm}\PY{o}{.}\PY{n}{rank}\PY{p}{,} \PY{n}{data}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[stdout:0] data on rank 0 is:  1
[stdout:1] data on rank 3 is:  16
[stdout:2] data on rank 1 is:  4
[stdout:3] data on rank 2 is:  9
    \end{Verbatim}

    \subsection{Gather (and Barrier)
Example}\label{gather-and-barrier-example}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{k+kn}{from} \PY{n+nn}{mpi4py} \PY{k+kn}{import} \PY{n}{MPI}
         
         \PY{n}{comm} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{COMM\PYZus{}WORLD}
         \PY{n}{size} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}size}\PY{p}{(}\PY{p}{)}
         \PY{n}{rank} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}rank}\PY{p}{(}\PY{p}{)}
         
         \PY{n}{data} \PY{o}{=} \PY{p}{(}\PY{n}{rank}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
         \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{before gather, data on }\PY{l+s+se}{\PYZbs{}}
         \PY{l+s}{  rank }\PY{l+s+si}{\PYZpc{}d}\PY{l+s}{ is: }\PY{l+s}{\PYZdq{}}\PY{o}{\PYZpc{}}\PY{k}{rank}\PY{p}{,} \PY{n}{data}
         
         \PY{n}{comm}\PY{o}{.}\PY{n}{Barrier}\PY{p}{(}\PY{p}{)}
         \PY{n}{data} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{gather}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{root}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{k}{if} \PY{n}{rank} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{size}\PY{p}{)}\PY{p}{:}
                \PY{k}{assert} \PY{n}{data}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{==} \PY{p}{(}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
         \PY{k}{else}\PY{p}{:}
            \PY{k}{assert} \PY{n}{data} \PY{o+ow}{is} \PY{n+nb+bp}{None}
         \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{data on rank: }\PY{l+s+si}{\PYZpc{}d}\PY{l+s}{ is: }\PY{l+s}{\PYZdq{}}\PY{o}{\PYZpc{}}\PY{k}{rank}\PY{p}{,} \PY{n}{data}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[stdout:0] 
before gather, data on   rank 0 is:  1
data on rank: 0 is:  [1, 4, 9, 16]
[stdout:1] 
before gather, data on   rank 3 is:  16
data on rank: 3 is:  None
[stdout:2] 
before gather, data on   rank 1 is:  4
data on rank: 1 is:  None
[stdout:3] 
before gather, data on   rank 2 is:  9
data on rank: 2 is:  None
    \end{Verbatim}

    \subsection{Collective Examples}\label{collective-examples}

    \subsection{Reduce Example}\label{reduce-example}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{k+kn}{from} \PY{n+nn}{mpi4py} \PY{k+kn}{import} \PY{n}{MPI}
         \PY{n}{comm} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{COMM\PYZus{}WORLD}
         
         \PY{n}{sendmsg} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{rank}
         \PY{n}{recvmsg1} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{reduce}\PY{p}{(}\PY{n}{sendmsg}\PY{p}{,} \PY{n}{op}\PY{o}{=}\PY{n}{MPI}\PY{o}{.}\PY{n}{SUM}\PY{p}{,} \PY{n}{root}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{n}{recvmsg2} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{allreduce}\PY{p}{(}\PY{n}{sendmsg}\PY{p}{)}
         
         \PY{k}{print} \PY{n}{recvmsg2}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[stdout:0] 6
[stdout:1] 6
[stdout:2] 6
[stdout:3] 6
    \end{Verbatim}

    \begin{longtable}[c]{@{}l@{}}
\toprule\addlinespace
Compute Pi Example
\\\addlinespace
\bottomrule
\end{longtable}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{k+kn}{from} \PY{n+nn}{mpi4py} \PY{k+kn}{import} \PY{n}{MPI}
         \PY{k+kn}{import} \PY{n+nn}{math}
         
         \PY{k}{def} \PY{n+nf}{compute\PYZus{}pi}\PY{p}{(}\PY{n}{n}\PY{p}{,} \PY{n}{start}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{step}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
             \PY{n}{h} \PY{o}{=} \PY{l+m+mf}{1.0} \PY{o}{/} \PY{n}{n}
             \PY{n}{s} \PY{o}{=} \PY{l+m+mf}{0.0}
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{start}\PY{p}{,} \PY{n}{n}\PY{p}{,} \PY{n}{step}\PY{p}{)}\PY{p}{:}
                 \PY{n}{x} \PY{o}{=} \PY{n}{h} \PY{o}{*} \PY{p}{(}\PY{n}{i} \PY{o}{+} \PY{l+m+mf}{0.5}\PY{p}{)}
                 \PY{n}{s} \PY{o}{+}\PY{o}{=} \PY{l+m+mf}{4.0} \PY{o}{/} \PY{p}{(}\PY{l+m+mf}{1.0} \PY{o}{+} \PY{n}{x}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}
             \PY{k}{return} \PY{n}{s} \PY{o}{*} \PY{n}{h}
         
         \PY{n}{comm} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{COMM\PYZus{}WORLD}
         \PY{n}{nprocs} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}size}\PY{p}{(}\PY{p}{)}
         \PY{n}{myrank} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}rank}\PY{p}{(}\PY{p}{)}
         \PY{k}{if} \PY{n}{myrank} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
             \PY{n}{n} \PY{o}{=} \PY{l+m+mi}{10}
         \PY{k}{else}\PY{p}{:}
             \PY{n}{n} \PY{o}{=} \PY{n+nb+bp}{None}
         
         \PY{n}{n} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{bcast}\PY{p}{(}\PY{n}{n}\PY{p}{,} \PY{n}{root}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         
         \PY{n}{mypi} \PY{o}{=} \PY{n}{compute\PYZus{}pi}\PY{p}{(}\PY{n}{n}\PY{p}{,} \PY{n}{myrank}\PY{p}{,} \PY{n}{nprocs}\PY{p}{)}
         
         \PY{n}{pi} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{reduce}\PY{p}{(}\PY{n}{mypi}\PY{p}{,} \PY{n}{op}\PY{o}{=}\PY{n}{MPI}\PY{o}{.}\PY{n}{SUM}\PY{p}{,} \PY{n}{root}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         
         \PY{k}{if} \PY{n}{myrank} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
             \PY{n}{error} \PY{o}{=} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{pi} \PY{o}{\PYZhy{}} \PY{n}{math}\PY{o}{.}\PY{n}{pi}\PY{p}{)}
             \PY{k}{print} \PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{pi is approximately }\PY{l+s+si}{\PYZpc{}.16f}\PY{l+s}{, error is }\PY{l+s+si}{\PYZpc{}.16f}\PY{l+s}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{pi}\PY{p}{,} \PY{n}{error}\PY{p}{)}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[stdout:0] pi is approximately 3.1424259850010983, error is 0.0008333314113051
    \end{Verbatim}

    \begin{longtable}[c]{@{}l@{}}
\toprule\addlinespace
Mandelbrot Set Example
\\\addlinespace
\bottomrule
\end{longtable}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}14}]:} \PY{k}{def} \PY{n+nf}{mandelbrot} \PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{maxit}\PY{p}{)}\PY{p}{:}
             \PY{n}{c} \PY{o}{=} \PY{n}{x} \PY{o}{+} \PY{n}{y}\PY{o}{*}\PY{l+m+mi}{1j}
             \PY{n}{z} \PY{o}{=} \PY{l+m+mi}{0} \PY{o}{+} \PY{l+m+mi}{0j}
             \PY{n}{it} \PY{o}{=} \PY{l+m+mi}{0}
             \PY{k}{while} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{z}\PY{p}{)} \PY{o}{\PYZlt{}} \PY{l+m+mi}{2} \PY{o+ow}{and} \PY{n}{it} \PY{o}{\PYZlt{}} \PY{n}{maxit}\PY{p}{:}
                 \PY{n}{z} \PY{o}{=} \PY{n}{z}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{n}{c}
                 \PY{n}{it} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}
             \PY{k}{return} \PY{n}{it}
         
         \PY{n}{x1}\PY{p}{,} \PY{n}{x2} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{2.0}\PY{p}{,} \PY{l+m+mf}{1.0}
         \PY{n}{y1}\PY{p}{,} \PY{n}{y2} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{1.0}\PY{p}{,} \PY{l+m+mf}{1.0}
         \PY{n}{w}\PY{p}{,} \PY{n}{h} \PY{o}{=} \PY{l+m+mi}{150}\PY{p}{,} \PY{l+m+mi}{100}
         \PY{n}{maxit} \PY{o}{=} \PY{l+m+mi}{127}
         
         \PY{k+kn}{from} \PY{n+nn}{mpi4py} \PY{k+kn}{import} \PY{n}{MPI}
         \PY{k+kn}{import} \PY{n+nn}{numpy}
           
         \PY{n}{comm} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{COMM\PYZus{}WORLD}
         \PY{n}{size} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}size}\PY{p}{(}\PY{p}{)}
         \PY{n}{rank} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{Get\PYZus{}rank}\PY{p}{(}\PY{p}{)}
         
         \PY{c}{\PYZsh{} number of rows to compute here}
         \PY{n}{N} \PY{o}{=} \PY{n}{h} \PY{o}{/}\PY{o}{/} \PY{n}{size} \PY{o}{+} \PY{p}{(}\PY{n}{h} \PY{o}{\PYZpc{}} \PY{n}{size} \PY{o}{\PYZgt{}} \PY{n}{rank}\PY{p}{)}
         
         \PY{c}{\PYZsh{} first row to compute here}
         \PY{n}{start} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{scan}\PY{p}{(}\PY{n}{N}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{N}
         
         \PY{c}{\PYZsh{} array to store local result}
         \PY{n}{Cl} \PY{o}{=} \PY{n}{numpy}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{[}\PY{n}{N}\PY{p}{,} \PY{n}{w}\PY{p}{]}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{i}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         
         \PY{c}{\PYZsh{} compute owned rows}
         
         \PY{n}{dx} \PY{o}{=} \PY{p}{(}\PY{n}{x2} \PY{o}{\PYZhy{}} \PY{n}{x1}\PY{p}{)} \PY{o}{/} \PY{n}{w}
         \PY{n}{dy} \PY{o}{=} \PY{p}{(}\PY{n}{y2} \PY{o}{\PYZhy{}} \PY{n}{y1}\PY{p}{)} \PY{o}{/} \PY{n}{h}
         
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{N}\PY{p}{)}\PY{p}{:}
             \PY{n}{y} \PY{o}{=} \PY{n}{y1} \PY{o}{+} \PY{p}{(}\PY{n}{i} \PY{o}{+} \PY{n}{start}\PY{p}{)} \PY{o}{*} \PY{n}{dy}
             \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{w}\PY{p}{)}\PY{p}{:}
                 \PY{n}{x} \PY{o}{=} \PY{n}{x1} \PY{o}{+} \PY{n}{j} \PY{o}{*} \PY{n}{dx}
                 \PY{n}{Cl}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{]} \PY{o}{=} \PY{n}{mandelbrot}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{maxit}\PY{p}{)}
         
         \PY{c}{\PYZsh{} gather results at root (process 0)}
         \PY{n}{counts} \PY{o}{=} \PY{n}{comm}\PY{o}{.}\PY{n}{gather}\PY{p}{(}\PY{n}{N}\PY{p}{,} \PY{n}{root}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{n}{C} \PY{o}{=} \PY{n+nb+bp}{None}
         \PY{k}{if} \PY{n}{rank} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
             \PY{n}{C} \PY{o}{=} \PY{n}{numpy}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{[}\PY{n}{h}\PY{p}{,} \PY{n}{w}\PY{p}{]}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{i}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         
         \PY{n}{rowtype} \PY{o}{=} \PY{n}{MPI}\PY{o}{.}\PY{n}{INT}\PY{o}{.}\PY{n}{Create\PYZus{}contiguous}\PY{p}{(}\PY{n}{w}\PY{p}{)}
         \PY{n}{rowtype}\PY{o}{.}\PY{n}{Commit}\PY{p}{(}\PY{p}{)}
         
         \PY{n}{comm}\PY{o}{.}\PY{n}{Gatherv}\PY{p}{(}\PY{n}{sendbuf}\PY{o}{=}\PY{p}{[}\PY{n}{Cl}\PY{p}{,} \PY{n}{MPI}\PY{o}{.}\PY{n}{INT}\PY{p}{]}\PY{p}{,} \PY{n}{recvbuf}\PY{o}{=}\PY{p}{[}\PY{n}{C}\PY{p}{,} \PY{p}{(}\PY{n}{counts}\PY{p}{,} \PY{n+nb+bp}{None}\PY{p}{)}\PY{p}{,} \PY{n}{rowtype}\PY{p}{]}\PY{p}{,}\PY{n}{root}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         
         \PY{n}{rowtype}\PY{o}{.}\PY{n}{Free}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

    We now need to ``pull'' the C array for plotting so we disable autopx.
Make sure to re-enable it later on

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}18}]:} \PY{o}{\PYZpc{}}\PY{k}{autopx}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
\%autopx disabled
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{n}{view}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{rank}\PY{l+s}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}19}]:} [0, 3, 1, 2]
\end{Verbatim}
        
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}16}]:} \PY{c}{\PYZsh{} CC is an array of C from all ranks, so we use CC[0]}
         \PY{n}{CC} \PY{o}{=} \PY{n}{view}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{C}\PY{l+s}{\PYZsq{}}\PY{p}{]}
         \PY{n}{ranks} \PY{o}{=} \PY{n}{view}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{rank}\PY{l+s}{\PYZsq{}}\PY{p}{]}
         
         \PY{c}{\PYZsh{} Do the plotting}
         \PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k+kn}{import} \PY{n}{pyplot}
         \PY{c}{\PYZsh{} Some magic to get to MPI4PY rank 0, not necessarily engine rank 0}
         \PY{n}{pyplot}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{CC}\PY{p}{[}\PY{n}{ranks}\PY{o}{.}\PY{n}{index}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{]}\PY{p}{,} \PY{n}{aspect}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{equal}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{pyplot}\PY{o}{.}\PY{n}{spectral}\PY{p}{(}\PY{p}{)}
         \PY{n}{pyplot}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{03_Scaling_Python_files/03_Scaling_Python_44_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Toggle autopx back

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}17}]:} \PY{o}{\PYZpc{}}\PY{k}{autopx}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
\%autopx enabled
    \end{Verbatim}

    \begin{longtable}[c]{@{}l@{}}
\toprule\addlinespace
Advanced Capabilities
\\\addlinespace
\bottomrule
\end{longtable}

Other features supported by mpi4py

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  dynamic process spawning: Spawn(), Connect() and Disconnect()
\item
  one sided communication: Put(), Get(), Accumulate()
\item
  MPI-IO: Open(), Close(), Get\_view() and Set\_view()
\end{itemize}

    \begin{longtable}[c]{@{}l@{}}
\toprule\addlinespace
\begin{minipage}[b]{0.38\columnwidth}\raggedright
More Comprehensive mpi4py Tutorials
\end{minipage}
\\\addlinespace
\midrule\endhead
\begin{minipage}[t]{0.38\columnwidth}\raggedright
\end{minipage}
\\\addlinespace
\begin{minipage}[t]{0.38\columnwidth}\raggedright
* basics - http://mpi4py.scipy.org/docs/usrman/tutorial.html * advanced
- http://www.bu.edu/pasi/files/2011/01/Lisandro-Dalcin-mpi4py.pdf
\end{minipage}
\\\addlinespace
\begin{minipage}[t]{0.38\columnwidth}\raggedright
Interesting Scalable Applications and Tools
\end{minipage}
\\\addlinespace
\bottomrule
\end{longtable}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  PyTrilinos - http://trilinos.sandia.gov/packages/pytrilinos/
\item
  petsc4py - http://code.google.com/p/petsc4py/
\item
  PyClaw - http://numerics.kaust.edu.sa/pyclaw/
\item
  GPAW - https://wiki.fysik.dtu.dk/gpaw/
\end{itemize}


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
